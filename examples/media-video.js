import{R as T,D as u,Z as y,T as S,Y as b,_ as k,J as P,s as l,i as d,r as m,M as g,m as w,j as R,V,b as D,c as x,p as C}from"./makeScene2D-e6b541e7.js";import{c as E}from"./createRef-ad1ed90d.js";var r=globalThis&&globalThis.__decorate||function(p,e,t,i){var a=arguments.length,o=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(p,e,t,i);else for(var h=p.length-1;h>=0;h--)(c=p[h])&&(o=(a<3?c(o):a>3?c(e,t,o):c(e,t))||o);return a>3&&o&&Object.defineProperty(e,t,o),o};class s extends T{constructor({play:e,...t}){super(t),this.lastTime=-1,e&&this.play()}isPlaying(){return this.playing()}getCurrentTime(){return this.clampTime(this.time())}getDuration(){return this.video().duration}desiredSize(){const e=super.desiredSize();if(e.x===null&&e.y===null){const t=this.video();return{x:t.videoWidth,y:t.videoHeight}}return e}completion(){return this.clampTime(this.time())/this.video().duration}video(){const e=this.src(),t=`${this.key}/${e}`;let i=s.pool[t];return i||(i=document.createElement("video"),i.src=e,s.pool[t]=i),i.readyState<2&&u.collectPromise(new Promise(a=>{const o=()=>{a(),i.removeEventListener("canplay",o)};i.addEventListener("canplay",o)})),i}seekedVideo(){const e=this.video(),t=this.clampTime(this.time());return e.paused||e.pause(),this.lastTime===t||this.setCurrentTime(t),e}fastSeekedVideo(){const e=this.video(),t=this.clampTime(this.time());if(this.lastTime===t)return e;const i=this.playing()&&t<e.duration;return i?e.paused&&u.collectPromise(e.play()):e.paused||e.pause(),Math.abs(e.currentTime-t)>.2?this.setCurrentTime(t):i||(e.currentTime=t),e}draw(e){this.drawShape(e),this.clip()&&e.clip(this.getPath());const t=this.alpha();if(t>0){const i=this.view().playbackState(),a=i===y.Playing||i===y.Presenting?this.fastSeekedVideo():this.seekedVideo(),o=S.fromSizeCentered(this.computedSize());e.save(),t<1&&(e.globalAlpha*=t),e.imageSmoothingEnabled=this.smoothing(),b(e,a,o),e.restore()}this.drawChildren(e)}applyFlex(){super.applyFlex();const e=this.video();this.element.style.aspectRatio=(this.ratio()??e.videoWidth/e.videoHeight).toString()}setCurrentTime(e){const t=this.video();t.readyState<2||(t.currentTime=e,this.lastTime=e,t.seeking&&u.collectPromise(new Promise(i=>{const a=()=>{i(),t.removeEventListener("seeked",a)};t.addEventListener("seeked",a)})))}play(){const e=k().time,t=e()-this.time();this.playing(!0),this.time(()=>this.clampTime(e()-t))}pause(){this.playing(!1),this.time.save(),this.video().pause()}seek(e){const t=this.playing();this.time(this.clampTime(e)),t?this.play():this.pause()}clampTime(e){const t=this.video().duration;return this.loop()&&(e%=t),P(0,t,e)}collectAsyncResources(){super.collectAsyncResources(),this.seekedVideo()}}s.pool={};r([l()],s.prototype,"src",void 0);r([d(1),l()],s.prototype,"alpha",void 0);r([d(!0),l()],s.prototype,"smoothing",void 0);r([d(!1),l()],s.prototype,"loop",void 0);r([d(0),l()],s.prototype,"time",void 0);r([d(!1),l()],s.prototype,"playing",void 0);r([m()],s.prototype,"completion",null);r([m()],s.prototype,"video",null);r([m()],s.prototype,"seekedVideo",null);r([m()],s.prototype,"fastSeekedVideo",null);let f;f??(f=new g("media-video",!1));f.loadData({version:0,shared:{background:"rgb(36,36,36)",range:[0,null],size:{x:1920,y:1080},audioOffset:0},preview:{fps:30,resolutionScale:1},rendering:{fps:60,resolutionScale:2,colorSpace:"srgb",fileType:"image/png",quality:1}});const j=f;let v;v??(v=new g("media-video",!1));v.loadData({version:1,timeEvents:[],seed:3374664546});const z=v,F="/examples/example-0a0a4e3f.mp4",n=w(function*(p){const e=E();p.add(R(s,{ref:e,src:F})),e().play(),yield*e().scale(1.25,2).to(1,2)});n.name="media-video";z.attach(n.meta);n.onReplaced??(n.onReplaced=new V(n.config));const L=D({scenes:[n]}),$=x("media-video",{core:"3.8.0",two:"3.8.0",ui:"3.8.0",vitePlugin:"3.8.0"},[C()],L,j);export{$ as default};
