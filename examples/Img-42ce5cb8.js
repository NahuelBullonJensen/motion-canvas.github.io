import{u as f,R as w,D as y,T as S,Y as v,g as d,E,s as p,i as g,r as u}from"./makeScene2D-e6b541e7.js";function R(r){if(!m()||r.startsWith("/cors-proxy/"))return r;const e=new URL(window.location.toString());try{const t=new URL(r,e);if(!t.protocol.startsWith("http")||e.host===t.host||!C(t.host))return r}catch{return r}return`/cors-proxy/${encodeURIComponent(r)}`}function C(r){const e=x();if(e.length===0)return!0;for(const t of e)if(t.toLowerCase().trim()===r)return!0;return!1}function m(){return!1}let c;function x(){return{}.VITEST!=="true"&&c?[...c]:(c=function(){if(!m()||!{VITE_MC_PROXY_ENABLED:"false",BASE_URL:"/examples/",MODE:"production",DEV:!1,PROD:!0,SSR:!1})return[];const e={}.VITE_MC_PROXY_ALLOW_LIST??"[]",t=JSON.parse(e);Array.isArray(t)||f().error("Parsed Allow List expected to be an Array, but is "+typeof t);const n=[];for(const i of t){if(typeof i!="string"){f().warn("Unexpected Value in Allow List: "+i+". Expected a String. Skipping.");continue}n.push(i)}return n}(),[...c])}var s=globalThis&&globalThis.__decorate||function(r,e,t,n){var i=arguments.length,a=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,n);else for(var h=r.length-1;h>=0;h--)(l=r[h])&&(a=(i<3?l(a):i>3?l(e,t,a):l(e,t))||a);return i>3&&a&&Object.defineProperty(e,t,a),a};class o extends w{constructor(e){super(e)}desiredSize(){const e=super.desiredSize();if(e.x===null&&e.y===null){const t=this.image();return{x:t.naturalWidth,y:t.naturalHeight}}return e}image(){const e=R(this.src()),t=new URL(e,window.location.origin);if(t.origin===window.location.origin){const i=this.view().assetHash();t.searchParams.set("asset-hash",i)}let n=o.pool[e];return n||(n=document.createElement("img"),n.crossOrigin="anonymous",n.src=t.toString(),o.pool[e]=n),n.complete||y.collectPromise(new Promise((i,a)=>{n.addEventListener("load",i),n.addEventListener("error",a)})),n}imageCanvas(){const e=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not create an image canvas");return e}filledImageCanvas(){const e=this.imageCanvas(),t=this.image();return e.canvas.width=t.naturalWidth,e.canvas.height=t.naturalHeight,e.imageSmoothingEnabled=this.smoothing(),e.drawImage(t,0,0),e}draw(e){this.drawShape(e),this.clip()&&e.clip(this.getPath());const t=this.alpha();if(t>0){const n=S.fromSizeCentered(this.computedSize());e.save(),t<1&&(e.globalAlpha*=t),e.imageSmoothingEnabled=this.smoothing(),v(e,this.image(),n),e.restore()}this.drawChildren(e)}applyFlex(){super.applyFlex();const e=this.image();this.element.style.aspectRatio=(this.ratio()??e.naturalWidth/e.naturalHeight).toString()}getColorAtPoint(e){const t=this.computedSize(),n=this.naturalSize(),i=new d(e).add(this.computedSize().scale(.5)).mul(n.div(t).safe);return this.getPixelColor(i)}naturalSize(){const e=this.image();return new d(e.naturalWidth,e.naturalHeight)}getPixelColor(e){const t=this.filledImageCanvas(),n=new d(e),i=t.getImageData(n.x,n.y,1,1).data;return new E({r:i[0],g:i[1],b:i[2],a:i[3]/255})}collectAsyncResources(){super.collectAsyncResources(),this.image()}}o.pool={};s([p()],o.prototype,"src",void 0);s([g(1),p()],o.prototype,"alpha",void 0);s([g(!0),p()],o.prototype,"smoothing",void 0);s([u()],o.prototype,"image",null);s([u()],o.prototype,"imageCanvas",null);s([u()],o.prototype,"filledImageCanvas",null);s([u()],o.prototype,"naturalSize",null);export{o as I};
