"use strict";(self.webpackChunk_motion_canvas_docs=self.webpackChunk_motion_canvas_docs||[]).push([[5483],{88733:(t,e,i)=>{i.d(e,{q:()=>s,r:()=>n});var s,r=i(1323);!function(t){t[t.Playing=0]="Playing",t[t.Rendering=1]="Rendering",t[t.Paused=2]="Paused",t[t.Presenting=3]="Presenting"}(s||(s={}));class n{constructor(){this.frame=0,this.speed=1,this.fps=30,this.duration=0,this.finished=!1,this.slides=[],this.previousScene=null,this.state=s.Paused,this.currentSceneReference=null,this.scenes=new r.G([])}get onSceneChanged(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.subscribable}get onScenesRecalculated(){return this.scenes.subscribable}get currentScene(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.current}set currentScene(t){if(!t)throw new Error("Invalid scene.");this.currentSceneReference??(this.currentSceneReference=new r.G(t)),this.currentSceneReference.current=t}setup(t){this.scenes.current=t,this.currentScene=t[0]}async progress(){return this.finished=await this.next(),this.finished}async seek(t){if(t<=this.frame||this.currentScene.isCached()&&this.currentScene.lastFrame<t){const e=this.findBestScene(t);e!==this.currentScene?(this.previousScene=null,this.currentScene=e,this.frame=this.currentScene.firstFrame,await this.currentScene.reset()):this.frame>=t&&(this.previousScene=null,this.frame=this.currentScene.firstFrame,await this.currentScene.reset())}for(this.finished=!1;this.frame<t&&!this.finished;)this.finished=await this.next();return this.finished}async goBack(){let t=this.currentScene.slides.getCurrent();if(t&&this.currentScene.slides.isWaiting()){const e=this.slides.indexOf(t);t=this.slides[e-1]}await this.seekSlide(t)}async goForward(){const t=this.currentScene.slides.getCurrent(),e=this.slides.indexOf(t);await this.seekSlide(this.slides[e+1])}async goTo(t){await this.seekSlide(this.slides.find((e=>e.id===t)))}async seekSlide(t){if(void 0===t&&(t=null),!t)return;const{id:e,scene:i}=t;for((this.currentScene!==i||this.currentScene.slides.didHappen(e))&&(this.previousScene=null,this.currentScene=i,this.frame=this.currentScene.firstFrame,this.currentScene.slides.setTarget(e),await this.currentScene.reset()),this.finished=!1,this.currentScene.slides.setTarget(e);!this.currentScene.slides.isWaitingFor(e)&&!this.finished;)this.finished=await this.next();return this.currentScene.slides.setTarget(null),this.finished}async reset(){this.previousScene=null,this.currentScene=this.scenes.current[0],this.frame=0,await this.currentScene.reset()}reload(t){this.scenes.current.forEach((e=>e.reload(t)))}async recalculate(){this.previousScene=null,this.slides=[];const t=this.speed;this.frame=0,this.speed=1;const e=[];try{for(const t of this.scenes.current)await t.recalculate((t=>{this.frame=t})),this.slides.push(...t.slides.onChanged.current),e.push(t)}finally{this.speed=t}this.scenes.current=e,this.duration=this.frame}async next(){if(this.previousScene&&(await this.previousScene.next(),this.currentScene.isFinished()&&(this.previousScene=null)),this.frame+=this.speed,this.currentScene.isFinished())return!0;if(await this.currentScene.next(),this.previousScene&&this.currentScene.isAfterTransitionIn()&&(this.previousScene=null),this.currentScene.canTransitionOut()){this.previousScene=this.currentScene;const t=this.getNextScene(this.previousScene);t&&(this.currentScene=t,await this.currentScene.reset(this.previousScene)),t&&!this.currentScene.isAfterTransitionIn()||(this.previousScene=null)}return this.currentScene.isFinished()}findBestScene(t){let e=this.scenes.current[0];for(const i of this.scenes.current){if(!i.isCached()||i.lastFrame>t)return i;e=i}return e}getNextScene(t){const e=this.scenes.current;if(!t)return e[0];const i=e.findIndex((e=>e===t));return i<0?null:e[i+1]??null}}},2672:(t,e,i)=>{i.d(e,{J:()=>v});var s=i(88733),r=i(1323),n=i(3163);class a{get onDataChanged(){return this.data.subscribable}constructor(t){this.logger=t,this.data=new r.G(null),this.context=new AudioContext,this.audioElement=new Audio,this.source=null,this.error=!1,this.abortController=null,this.offset=0}getTime(){return this.toAbsoluteTime(this.audioElement.currentTime)}setTime(t){this.audioElement.currentTime=this.toRelativeTime(t)}setOffset(t){this.offset=t}setMuted(t){this.audioElement.muted=t}setSource(t){var e;this.source=t,this.audioElement.src=t,null==(e=this.abortController)||e.abort(),this.abortController=new AbortController,this.loadData(this.abortController.signal).catch((t=>{"AbortError"!==t.name&&this.logger.error(t)}))}isInRange(t){return t>=this.offset&&t<this.audioElement.duration}toRelativeTime(t){return Math.max(0,t-this.offset)}toAbsoluteTime(t){return t+this.offset}isReady(){return this.source&&!this.error}async setPaused(t){if(this.source&&this.audioElement.paused!==t)if(t)this.audioElement.pause();else try{return await this.audioElement.play(),this.error=!1,!0}catch(e){this.error||(0,n.wL)().error(e),this.error=!0}return!1}async loadData(t){if(this.data.current=null,!this.source)return;const e=await fetch(this.source,{signal:t}),i=await e.arrayBuffer();if(t.aborted)return;const s=await this.decodeAudioData(i);if(t.aborted)return;const r=256,n=~~(s.length/r),a=[];let o=0;for(let h=0;h<s.numberOfChannels;h++){const t=s.getChannelData(h);for(let e=0;e<n;e++){const i=~~(e*r),s=~~(i+r);let n=t[i],c=n;for(let e=i;e<s;e++){const i=t[e];i>c&&(c=i),i<n&&(n=i)}(0===h||c>a[2*e])&&(a[2*e]=c),(0===h||n<a[2*e+1])&&(a[2*e+1]=n),c>o&&(o=c),Math.abs(n)>o&&(o=Math.abs(n))}}this.data.current={peaks:a,absoluteMax:o,length:n,sampleRate:s.sampleRate/r*2}}decodeAudioData(t){return new Promise(((e,i)=>this.context.decodeAudioData(t,e,i)))}}var o=i(13170),h=i(11395);class c extends h.p{async dispatch(t){await Promise.all(this.notifySubscribers(t))}}var u=i(96881),l=i(29797);class d{constructor(t){this.playback=t}secondsToFrames(t){return Math.ceil(t*this.playback.fps)}framesToSeconds(t){return t/this.playback.fps}get time(){return this.framesToSeconds(this.playback.frame)}get frame(){return this.playback.frame}get speed(){return this.playback.speed}get fps(){return this.playback.fps}get state(){return this.playback.state}}var p=i(15649);class f{get onChanged(){return this.events.subscribable}constructor(t){this.scene=t,this.events=new r.G([]),this.registeredEvents={},this.lookup={},this.collisionLookup=new Set,this.previousReference=[],this.didEventsChange=!1,this.preserveTiming=!0,this.handleReload=()=>{this.registeredEvents={},this.collisionLookup.clear()},this.handleRecalculated=()=>{var t;this.preserveTiming=!0,this.events.current=Object.values(this.registeredEvents),(this.didEventsChange||((null==(t=this.previousReference)?void 0:t.length)??0)!==this.events.current.length)&&(this.didEventsChange=!1,this.previousReference=Object.values(this.registeredEvents).map((t=>({name:t.name,targetTime:t.targetTime}))),this.scene.meta.timeEvents.set(this.previousReference))},this.handleReset=()=>{this.collisionLookup.clear()},this.handleMetaChanged=t=>{t!==this.previousReference&&(this.previousReference=t,this.load(t),this.scene.reload())},this.previousReference=t.meta.timeEvents.get(),this.load(this.previousReference),t.onReloaded.subscribe(this.handleReload),t.onRecalculated.subscribe(this.handleRecalculated),t.onReset.subscribe(this.handleReset),t.meta.timeEvents.onChanged.subscribe(this.handleMetaChanged,!1)}set(t,e,i){void 0===i&&(i=!0),this.lookup[t]&&this.lookup[t].offset!==e&&(this.preserveTiming=i,this.lookup[t]={...this.lookup[t],targetTime:this.lookup[t].initialTime+e,offset:e},this.registeredEvents[t]=this.lookup[t],this.events.current=Object.values(this.registeredEvents),this.didEventsChange=!0,this.scene.reload())}register(t,e){if(this.collisionLookup.has(t))return this.scene.logger.error({message:`name "${t}" has already been used for another event name.`,stack:(new Error).stack}),0;if(this.collisionLookup.add(t),this.lookup[t]){let i=!1;const s={...this.lookup[t]},r=(new Error).stack;s.stack!==r&&(s.stack=r,i=!0),s.initialTime!==e&&(s.initialTime=e,i=!0);const n=Math.max(0,s.targetTime-s.initialTime);this.preserveTiming&&s.offset!==n&&(s.offset=n,i=!0);const a=s.initialTime+s.offset;this.preserveTiming||s.targetTime===a||(this.didEventsChange=!0,s.targetTime=a,i=!0),i&&(this.lookup[t]=s)}else this.didEventsChange=!0,this.lookup[t]={name:t,initialTime:e,targetTime:e,offset:0,stack:(new Error).stack};return this.registeredEvents[t]=this.lookup[t],this.lookup[t].offset}load(t){for(const e of t){const t=this.lookup[e.name]??{name:e.name,initialTime:0,offset:0};this.lookup[e.name]={...t,targetTime:e.targetTime}}}}class v{get onRender(){return this.render.subscribable}get onStateChanged(){return this.playerState.subscribable}get onFrameChanged(){return this.frame.subscribable}get onDurationChanged(){return this.duration.subscribable}get onRecalculated(){return this.recalculated.subscribable}get startFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.startTime))}get endFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.endTime))}get finished(){return this.playback.finished||this.playback.frame>=this.endFrame}constructor(t,e,i,n){var o,h;void 0===e&&(e={}),void 0===i&&(i={}),void 0===n&&(n=-1),this.project=t,this.settings=e,this.initialState=i,this.initialFrame=n,this.render=new c,this.frame=new r.G(0),this.duration=new r.G(0),this.recalculated=new u.p,this.lock=new p.L,this.startTime=0,this.endTime=1/0,this.requestId=null,this.renderTime=0,this.requestedSeek=-1,this.requestedRecalculation=!0,this.active=!1,this.playerState=new r.G({loop:!0,muted:!0,speed:1,...i,paused:!0}),this.requestedSeek=n,this.logger=this.project.logger,this.playback=new s.r,this.status=new d(this.playback),this.audio=new a(this.logger),this.size=e.size??new l.F(1920,1080),this.resolutionScale=e.resolutionScale??1,this.startTime=(null==(o=e.range)?void 0:o[0])??0,this.endTime=(null==(h=e.range)?void 0:h[1])??1/0,this.playback.fps=e.fps??60,this.audio.setOffset(e.audioOffset??0),t.audio&&this.audio.setSource(t.audio);const v=[];for(const s of t.scenes){var y;const e=new s.klass({...s,playback:this.status,logger:this.project.logger,size:this.size,resolutionScale:this.resolutionScale,timeEventsClass:f});null==(y=s.onReplaced)||y.subscribe((t=>{e.reload(t)}),!1),e.onReloaded.subscribe((()=>this.requestRecalculation())),e.variables.updateSignals(t.variables??{}),v.push(e)}this.playback.setup(v),this.activate()}async configure(t){await this.lock.acquire();let e=this.playback.frame,i=!1;if(this.startTime=t.range[0],this.endTime=t.range[1],this.playback.fps!==t.fps){const s=t.fps/this.playback.fps;this.playback.fps=t.fps,e=Math.floor(e*s),i=!0}t.size.exactlyEquals(this.size)&&t.resolutionScale===this.resolutionScale||(this.size=t.size,this.resolutionScale=t.resolutionScale,this.playback.reload({size:this.size,resolutionScale:this.resolutionScale})),void 0!==t.audioOffset&&this.audio.setOffset(t.audioOffset),this.lock.release(),i&&(this.playback.reload(),this.frame.current=e,this.requestRecalculation(),this.requestedSeek=e)}requestSeek(t){this.requestedSeek=this.clampRange(t)}requestPreviousFrame(){this.requestedSeek=this.frame.current-this.playback.speed}requestNextFrame(){this.requestedSeek=this.frame.current+this.playback.speed}requestReset(){this.requestedSeek=0}toggleLoop(t){void 0===t&&(t=!this.playerState.current.loop),t!==this.playerState.current.loop&&(this.playerState.current={...this.playerState.current,loop:t})}togglePlayback(t){void 0===t&&(t=this.playerState.current.paused),t===this.playerState.current.paused&&(this.playerState.current={...this.playerState.current,paused:!t},t&&!this.playerState.current.loop&&this.playback.frame===this.playback.duration&&this.requestReset())}toggleAudio(t){void 0===t&&(t=this.playerState.current.muted),t===this.playerState.current.muted&&(this.playerState.current={...this.playerState.current,muted:!t})}setSpeed(t){t!==this.playerState.current.speed&&(this.playback.speed=t,this.playback.reload(),this.playerState.current={...this.playerState.current,speed:t},this.requestRecalculation())}setVariables(t){for(const e of this.playback.onScenesRecalculated.current)e.variables.updateSignals(t)}activate(){this.active=!0,this.request()}deactivate(){this.active=!1,null!==this.requestId&&(cancelAnimationFrame(this.requestId),this.requestId=null)}requestRecalculation(){this.requestedRecalculation=!0,this.request()}async prepare(){const t={...this.playerState.current,seek:this.requestedSeek};if(this.requestedSeek=-1,this.requestedRecalculation){t.seek<0&&(t.seek=this.playback.frame);try{await this.playback.recalculate(),this.duration.current=this.playback.frame,this.recalculated.dispatch()}catch(i){throw this.requestSeek(t.seek),i}finally{this.requestedRecalculation=!1}}(!t.loop&&this.finished&&!t.paused&&t.seek<0||this.endFrame===this.startFrame)&&(this.togglePlayback(!1),t.paused=!0),t.loop&&(t.seek>this.endFrame||this.finished&&!t.paused)&&this.startFrame!==this.endTime&&(t.seek=this.startFrame);const e=t.paused||this.finished||!this.audio.isInRange(this.status.time);return await this.audio.setPaused(e)&&this.syncAudio(-3),this.audio.setMuted(t.muted),t}async run(){const t=await this.prepare(),e=this.playback.state;if(this.playback.state=t.paused?s.q.Paused:s.q.Playing,t.seek>=0||!this.isInRange(this.status.frame)){const e=t.seek<0?this.status.frame:t.seek,i=this.clampRange(e);this.logger.profile("seek time"),await this.playback.seek(i),this.logger.profile("seek time"),this.syncAudio(-3)}else{if(t.paused||1===t.speed&&this.audio.isReady()&&this.audio.isInRange(this.status.time)&&this.audio.getTime()<this.status.time)return t.paused&&e!==s.q.Paused&&await this.render.dispatch(),!t.paused&&this.status.time>this.audio.getTime()+.02&&this.syncAudio(),void this.request();if(this.audio.isReady()&&1===t.speed&&this.audio.isInRange(this.status.time)&&this.status.framesToSeconds(this.playback.frame+1)<this.audio.getTime()-.02){const t=this.status.secondsToFrames(this.audio.getTime());await this.playback.seek(t)}else this.status.frame<this.endFrame&&(await this.playback.progress(),1!==t.speed&&this.syncAudio())}!t.paused&&this.playback.currentScene.slides.isWaiting()&&(this.togglePlayback(!1),t.paused=!0),await this.render.dispatch(),this.frame.current=this.playback.frame,this.request()}request(){this.active&&(this.requestId??(this.requestId=requestAnimationFrame((async t=>{if(this.requestId=null,t-this.renderTime>=1e3/(this.status.fps+5)){this.renderTime=t,await this.lock.acquire();try{await this.run()}catch(e){this.logger.error(e)}this.lock.release()}else this.request()}))))}clampRange(t){return(0,o.uZ)(this.startFrame,this.endFrame,t)}isInRange(t){return t>=this.startFrame&&t<=this.endFrame}syncAudio(t){void 0===t&&(t=0),this.audio.setTime(this.status.framesToSeconds(this.playback.frame+t))}}},9989:(t,e,i)=>{i.d(e,{H:()=>n});var s=i(1119),r=i(29797);class n{get canvasSize(){return this.size.scale(this.resolutionScale)}constructor(){this.background=null,this.resolutionScale=1,this.colorSpace="srgb",this.size=r.F.zero,this.finalBuffer=document.createElement("canvas"),this.currentBuffer=document.createElement("canvas"),this.previousBuffer=document.createElement("canvas");const t=this.colorSpace;this.context=(0,s.f)({colorSpace:t},this.finalBuffer),this.currentContext=(0,s.f)({colorSpace:t},this.currentBuffer),this.previousContext=(0,s.f)({colorSpace:t},this.previousBuffer)}configure(t){let{colorSpace:e=this.colorSpace,size:i=this.size,resolutionScale:r=this.resolutionScale,background:n=this.background}=t;e!==this.colorSpace&&(this.colorSpace=e,this.context=(0,s.f)({colorSpace:e},this.finalBuffer),this.currentContext=(0,s.f)({colorSpace:e},this.currentBuffer),this.previousContext=(0,s.f)({colorSpace:e},this.previousBuffer)),i.exactlyEquals(this.size)&&r===this.resolutionScale||(this.resolutionScale=r,this.size=i,this.resizeCanvas(this.context),this.resizeCanvas(this.currentContext),this.resizeCanvas(this.previousContext)),this.background="string"==typeof n?n:(null==n?void 0:n.serialize())??null}async render(t,e){e&&(this.transformCanvas(this.previousContext),await e.render(this.previousContext)),this.transformCanvas(this.currentContext),await t.render(this.currentContext);const i=this.canvasSize;this.context.clearRect(0,0,i.width,i.height),this.background&&(this.context.save(),this.context.fillStyle=this.background,this.context.fillRect(0,0,i.width,i.height),this.context.restore()),e&&this.context.drawImage(this.previousBuffer,0,0),this.context.drawImage(this.currentBuffer,0,0)}transformCanvas(t){const e=this.canvasSize.scale(.5);t.setTransform(this.resolutionScale,0,0,this.resolutionScale,e.x,e.y)}resizeCanvas(t){const e=this.canvasSize;t.canvas.width=e.width,t.canvas.height=e.height}}},42075:(t,e,i)=>{function s(t){const e={[t.name]:t},i=Object.getOwnPropertyDescriptor(e,t.name);if(i){for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];for(let s=r.length-1;s>=0;s--)r[s](e,t.name,i)}}i.d(e,{G:()=>s})},67292:(t,e,i)=>{function s(t){return function(e,i,s){s.value.prototype.name=t??i,s.value.prototype.threadable=!0}}i.d(e,{C:()=>s})},96881:(t,e,i)=>{i.d(e,{p:()=>r});var s=i(11395);class r extends s.p{dispatch(t){this.notifySubscribers(t)}}},11395:(t,e,i)=>{i.d(e,{l:()=>r,p:()=>s});class s{constructor(){this.subscribable=new r(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map((e=>e(t)))}}class r{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}},1323:(t,e,i)=>{i.d(e,{G:()=>r});var s=i(11395);class r extends s.p{set current(t){this.value=t,this.notifySubscribers(t)}get current(){return this.value}constructor(t){super(),this.value=t,this.subscribable=new n(this)}subscribe(t,e){void 0===e&&(e=!0);const i=super.subscribe(t);return e&&t(this.value),i}}class n extends s.l{get current(){return this.dispatcher.current}subscribe(t,e){return void 0===e&&(e=!0),this.dispatcher.subscribe(t,e)}}},77396:(t,e,i)=>{i.d(e,{K:()=>r});var s=i(75168);function r(t,e){let i;return"string"==typeof t?(i=e(),(0,s.i)(i,t)):(i=t(),(0,s.i)(i,i)),i}},84266:(t,e,i)=>{i.d(e,{A:()=>h,X:()=>c});var s=i(42075),r=i(67292),n=i(30092),a=i(56632),o=i(97715);function*h(t,e){yield*c((0,n.Y)(t)),e&&(yield*e)}function*c(t,e){void 0===t&&(t=0);const i=(0,a.nn)(),s=(0,o.te)().framesToSeconds(1),r=i.time()+t;for(;r-s>i.fixed;)yield;i.time(r),e&&(yield*e)}(0,s.G)(h,(0,r.C)()),(0,s.G)(c,(0,r.C)())},46096:(t,e,i)=>{i.d(e,{N:()=>a});var s=i(13170),r=i(16249),n=i(68003);class a extends r.V{constructor(t,e,i,a,o,h){var c;void 0===o&&(o=void 0),void 0===h&&(h={}),super(void 0,a,o,e,h),this.entries=t,this.signals=[],this.parser=e;for(const u of t){let t,a;Array.isArray(u)?([t,a]=u,(c=a.context).owner??(c.owner=this)):(t=u,a=new r.V((0,n.Pj)(i,(t=>e(t)[u])),s.UI,o??this.invokable).toSignal()),this.signals.push([t,a]),Object.defineProperty(this.invokable,t,{value:a})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map((t=>{let[e,i]=t;return[e,i()]}))))}setter(t){if((0,n.PG)(t))for(const[e,i]of this.signals)i((()=>this.parser(t())[e]));else{const e=this.parse(t);for(const[t,i]of this.signals)i(e[t])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}}},76062:(t,e,i)=>{i.d(e,{k:()=>a});var s=i(11395);class r extends s.p{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}var n=i(49111);class a{static collectPromise(t,e){void 0===e&&(e=null);const i={promise:t,value:e,stack:(new Error).stack},s=this.collectionStack.at(-1);return s&&(i.owner=s.owner),t.then((t=>{i.value=t,null==s||s.markDirty()})),this.promises.push(i),i}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map((t=>t.promise))),this.promises=this.promises.filter((e=>!t.includes(e))),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new r,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(a.collectionSet.has(this))throw new n.t("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");a.collectionSet.add(this),a.collectionStack.push(this)}finishCollecting(){if(a.collectionSet.delete(this),a.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((t=>t.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const t=a.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await a.consumePromises(),this.invokable()}while(a.hasPromises());return this.invokable}}a.collectionSet=new Set,a.collectionStack=[],a.promises=[]},16249:(t,e,i)=>{i.d(e,{V:()=>d});var s=i(97074),r=i(74534),n=i(3163),a=i(90031),o=i(77396),h=i(84266),c=i(76062),u=i(68003),l=i(60771);class d extends c.k{constructor(t,e,i,s,r){void 0===i&&(i=void 0),void 0===s&&(s=t=>t),void 0===r&&(r={}),super(i),this.initial=t,this.interpolation=e,this.parser=s,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),(0,u.PG)(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===l.T&&(t=this.initial),this.current===t||(this.current=t,this.markDirty(),this.clearDependencies(),(0,u.PG)(t)||(this.last=this.parse(t))),this.owner}get(){return this.extensions.getter()}getter(){if(this.event.isRaised()&&(0,u.PG)(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(e){var t;(0,n.wL)().error({...(0,a.d)(e),inspect:null==(t=this.owner)?void 0:t.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(t,e,i,r){if(void 0===i&&(i=s.qb),void 0===r&&(r=this.interpolation),void 0===t)return this.get();if(void 0===e)return this.set(t);return this.createQueue(i,r).to(t,e)}createQueue(t,e){var i=this;const s=this.get(),r=[],n=(0,o.K)((function*(){for(;r.length>0;)yield*r.shift()}));return n.to=function(s,a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(i.tween(s,a,o,h)),n},n.back=function(a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(i.tween(s,a,t,e)),n},n.wait=t=>(r.push((0,h.X)(t)),n),n.run=t=>(r.push(t),n),n.do=t=>(r.push((0,o.K)((function*(){t()}))),n),n}*tween(t,e,i,s){t===l.T&&(t=this.initial),yield*this.extensions.tweener(t,e,i,s),this.set(t)}*tweener(t,e,i,s){const n=this.get();yield*(0,r.i)(e,(e=>{this.set(s(n,this.parse((0,u.Wg)(t)),i(e)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}},60771:(t,e,i)=>{i.d(e,{T:()=>s});const s=Symbol.for("@motion-canvas/core/signals/default")},68003:(t,e,i)=>{function s(t){return"function"==typeof t}function r(t,e){return s(t)?()=>e(t()):e(t)}function n(t){return s(t)?t():t}i.d(e,{PG:()=>s,Pj:()=>r,Wg:()=>n})},75168:(t,e,i)=>{function s(t,e){const i=Object.getPrototypeOf(t);i.threadable||(i.threadable=!0,i.name="string"==typeof e?e:r(e))}function r(t){return Object.getPrototypeOf(t).name??null}i.d(e,{i:()=>s,z:()=>r})},13170:(t,e,i)=>{i.d(e,{JC:()=>n,UI:()=>o,Vz:()=>l,a2:()=>h,o0:()=>a,uZ:()=>c,vl:()=>u});var s=i(3163),r=i(29797);function n(t,e,i){if(e.length>=t.length){const s=Math.floor(e.length*i),r=Math.floor(o(t.length-1,e.length,i));let n="";for(let i=0;i<e.length;i++)i<s?n+=e[i]:(t[i]||i<=r)&&(n+=t[i]??e[i]);return n}{const s=Math.round(t.length*(1-i)),r=Math.floor(o(t.length+1,e.length,i)),n=[];for(let i=t.length-1;i>=0;i--)i<s?n.unshift(t[i]):(e[i]||i<r)&&n.unshift(e[i]??t[i]);return n.join("")}}function a(t,e,i,r){if(void 0===r&&(r=!1),0===i)return t;if(1===i)return e;if(null!=t&&null!=e){if("number"==typeof t&&"number"==typeof e)return o(t,e,i);if("string"==typeof t&&"string"==typeof e)return n(t,e,i);if("boolean"==typeof t&&"boolean"==typeof e)return i<.5?t:e;if("lerp"in t)return t.lerp(e,i);if(t&&e&&"object"==typeof t&&"object"==typeof e)if(Array.isArray(t)&&Array.isArray(e)){if(t.length===e.length)return t.map(((t,s)=>a(t,e[s],i)))}else{let s=!1;if(t instanceof Map||e instanceof Map||(s=!0,t=new Map(Object.entries(t)),e=new Map(Object.entries(e))),t instanceof Map&&e instanceof Map){const r=new Map;for(const s of new Set([...t.keys(),...e.keys()])){const n=a(t.get(s),e.get(s),i,!0);void 0!==n&&r.set(s,n)}return s?Object.fromEntries(r):r}}return e}r||(0,s.wL)().warn(`Attempting to lerp ${t} -> ${e} may result in unexpected behavior.`)}function o(t,e,i){return t+(e-t)*i}function h(t,e,i,s,r){return i+(r-t)*(s-i)/(e-t)}function c(t,e,i){return i<t?t:i>e?e:i}function u(t,e,i,s,r){const n=h(t,e,i,s,r);return i>s&&([i,s]=[s,i]),c(i,s,n)}function l(t,e,i){let s=e;i>1?i=1/i:s=!s;const n=o(s?Math.acos(c(-1,1,1-t)):Math.asin(t),o(0,Math.PI/2,t),i);let a=Math.sin(n),h=1-Math.cos(n);return e&&([a,h]=[h,a]),new r.F(a,h)}},97074:(t,e,i)=>{i.d(e,{BH:()=>B,Bl:()=>C,C6:()=>G,FG:()=>h,Fs:()=>o,GE:()=>j,Ge:()=>I,Ij:()=>D,J7:()=>y,Kx:()=>E,Mg:()=>x,N1:()=>n,O$:()=>r,Q9:()=>l,SJ:()=>F,UE:()=>N,Y3:()=>v,Yw:()=>z,ad:()=>k,cv:()=>V,du:()=>q,eE:()=>Z,e_:()=>w,ei:()=>M,en:()=>U,g4:()=>f,hN:()=>S,hl:()=>c,j$:()=>T,jv:()=>A,lj:()=>P,mC:()=>O,n5:()=>g,pl:()=>m,qS:()=>R,qb:()=>p,rz:()=>b,sK:()=>H,to:()=>u,vh:()=>a,w2:()=>d,zk:()=>L});var s=i(13170);function r(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),(0,s.a2)(-1,1,e,i,Math.sin(t))}function n(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1-Math.cos(t*Math.PI/2),(0,s.UI)(e,i,t)}function a(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=Math.sin(t*Math.PI/2),(0,s.UI)(e,i,t)}function o(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=-(Math.cos(Math.PI*t)-1)/2,(0,s.UI)(e,i,t)}function h(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t*=t,(0,s.UI)(e,i,t)}function c(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1-Math.pow(1-t,2),(0,s.UI)(e,i,t)}function u(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,(0,s.UI)(e,i,t)}function l(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t*=t*t,(0,s.UI)(e,i,t)}function d(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1-Math.pow(1-t,3),(0,s.UI)(e,i,t)}function p(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,(0,s.UI)(e,i,t)}function f(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t*=t*t*t,(0,s.UI)(e,i,t)}function v(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1-Math.pow(1-t,4),(0,s.UI)(e,i,t)}function y(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,(0,s.UI)(e,i,t)}function g(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t*=t*t*t*t,(0,s.UI)(e,i,t)}function m(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1-Math.pow(1-t,5),(0,s.UI)(e,i,t)}function b(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,(0,s.UI)(e,i,t)}function w(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=0===t?0:Math.pow(2,10*t-10),(0,s.UI)(e,i,t)}function k(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1===t?1:1-Math.pow(2,-10*t),(0,s.UI)(e,i,t)}function S(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,(0,s.UI)(e,i,t)}function x(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=1-Math.sqrt(1-Math.pow(t,2)),(0,s.UI)(e,i,t)}function M(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=Math.sqrt(1-Math.pow(t-1,2)),(0,s.UI)(e,i,t)}function I(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t=t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,(0,s.UI)(e,i,t)}function T(t){return void 0===t&&(t=1.70158),function(e,i,r){return void 0===i&&(i=0),void 0===r&&(r=1),e=(t+1)*e*e*e-t*e*e,(0,s.UI)(i,r,e)}}function P(t){return void 0===t&&(t=1.70158),function(e,i,r){return void 0===i&&(i=0),void 0===r&&(r=1),e=1+(t+1)*Math.pow(e-1,3)+t*Math.pow(e-1,2),(0,s.UI)(i,r,e)}}function C(t,e){return void 0===t&&(t=1.70158),void 0===e&&(e=1.525),function(i,r,n){return void 0===r&&(r=0),void 0===n&&(n=1),i=i<.5?Math.pow(2*i,2)*(2*(t*e+1)*i-t*e)/2:(Math.pow(2*i-2,2)*((t*e+1)*(2*i-2)+t*e)+2)/2,(0,s.UI)(r,n,i)}}function R(t){return void 0===t&&(t=2.094395),function(e,i,r){return void 0===i&&(i=0),void 0===r&&(r=1),e=0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*t),(0,s.UI)(i,r,e)}}function E(t){return void 0===t&&(t=2.094395),function(e,i,r){return void 0===i&&(i=0),void 0===r&&(r=1),e=0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1,(0,s.UI)(i,r,e)}}function q(t){return void 0===t&&(t=1.39626),function(e,i,r){return void 0===i&&(i=0),void 0===r&&(r=1),e=0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*t)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*t)/2+1,(0,s.UI)(i,r,e)}}function A(t,e){void 0===t&&(t=7.5625),void 0===e&&(e=2.75);const i=L(t,e);return function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),1-i(1-t,e,s)}}function L(t,e){return void 0===t&&(t=7.5625),void 0===e&&(e=2.75),function(i,r,n){return void 0===r&&(r=0),void 0===n&&(n=1),i<1/e?i*=t*i:i=i<2/e?t*(i-=1.505/e)*i+.75:i<2.5/e?t*(i-=2.25/e)*i+.9375:t*(i-=2.625/e)*i+.984375,(0,s.UI)(r,n,i)}}function D(t,e){void 0===t&&(t=7.5625),void 0===e&&(e=2.75);const i=L(t,e);return function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),t<.5?(1-i(1-2*t,e,s))/2:(1+i(2*t-1,e,s))/2}}function j(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),(0,s.UI)(e,i,t)}function O(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),(0,s.a2)(-1,1,e,i,Math.cos(t))}const z=T(),N=P(),B=C(),F=A(),G=L(),U=D(),Z=R(),H=E(),V=q()},74534:(t,e,i)=>{i.d(e,{i:()=>a});var s=i(42075),r=i(67292),n=i(56632);function*a(t,e,i){const s=(0,n.nn)(),r=s.time(),a=s.time()+t;for(e(0,0);a>s.fixed;){const i=s.fixed-r;i>0&&e(i/t,i),yield}s.time(a),e(1,t),null==i||i(1,t)}(0,s.G)(a,(0,r.C)())},98378:(t,e,i)=>{i.d(e,{M5:()=>s,Nm:()=>r,WS:()=>h,aP:()=>n,lk:()=>o});var s,r,n,a=i(29797);function o(t,e){return void 0===e&&(e=s.Horizontal|s.Vertical),e&s.Vertical&&(t&r.Top?t=t&~r.Top|r.Bottom:t&r.Bottom&&(t=t&~r.Bottom|r.Top)),e&s.Horizontal&&(t&r.Left?t=t&~r.Left|r.Right:t&r.Right&&(t=t&~r.Right|r.Left)),t}function h(t){if(t===n.Middle)return a.F.zero;let e=0;t&r.Left?e=-1:t&r.Right&&(e=1);let i=0;return t&r.Top?i=-1:t&r.Bottom&&(i=1),new a.F(e,i)}!function(t){t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal"}(s||(s={})),function(t){t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.Left=16]="Left",t[t.Right=32]="Right"}(r||(r={})),function(t){t[t.Middle=3]="Middle",t[t.Top=5]="Top",t[t.Bottom=9]="Bottom",t[t.Left=18]="Left",t[t.Right=34]="Right",t[t.TopLeft=20]="TopLeft",t[t.TopRight=36]="TopRight",t[t.BottomLeft=24]="BottomLeft",t[t.BottomRight=40]="BottomRight"}(n||(n={}))},57292:(t,e,i)=>{i.d(e,{I:()=>s,P:()=>r});const s=1e-6;function r(t){return t&&"object"==typeof t&&"toSymbol"in t}},29797:(t,e,i)=>{i.d(e,{F:()=>h});var s=i(13170),r=i(98378),n=i(57292),a=i(46096),o=i(48733);class h{static createSignal(t,e,i){return void 0===e&&(e=h.lerp),new a.N(["x","y"],(t=>new h(t)),t,e,i).toSignal()}static lerp(t,e,i){let r,n;return"number"==typeof i?r=n=i:(r=i.x,n=i.y),new h((0,s.UI)(t.x,e.x,r),(0,s.UI)(t.y,e.y,n))}static arcLerp(t,e,i,r,n){return void 0===r&&(r=!1),n??(n=t.sub(e).ctg),h.lerp(t,e,(0,s.Vz)(i,r,n))}static createArcLerp(t,e){return(i,s,r)=>h.arcLerp(i,s,r,t,e)}static fromOrigin(t){const e=new h;return t===r.aP.Middle||(t&r.Nm.Left?e.x=-1:t&r.Nm.Right&&(e.x=1),t&r.Nm.Top?e.y=-1:t&r.Nm.Bottom&&(e.y=1)),e}static fromScalar(t){return new h(t,t)}static fromRadians(t){return new h(Math.cos(t),Math.sin(t))}static fromDegrees(t){return h.fromRadians(t*o.q)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return h.radians(t,e)*o.I}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return h.magnitude(this.x,this.y)}get squaredMagnitude(){return h.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/h.magnitude(this.x,this.y))}get safe(){return new h(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new h(-this.x,-this.y)}get floored(){return new h(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new h(this.y,-this.x)}get radians(){return h.radians(this.x,this.y)}get degrees(){return h.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,null!=t){if("object"!=typeof t)return this.x=t,void(this.y=e??t);if(Array.isArray(t))return this.x=t[0],void(this.y=t[1]);if("width"in t)return this.x=t.width,void(this.y=t.height);this.x=t.x,this.y=t.y}}lerp(t,e){return h.lerp(this,t,e)}getOriginOffset(t){const e=h.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new h(this.x*t,this.y*t)}transformAsPoint(t){return new h(this.x*t.m11+this.y*t.m21+t.m41,this.x*t.m12+this.y*t.m22+t.m42)}transform(t){return new h(this.x*t.m11+this.y*t.m21,this.x*t.m12+this.y*t.m22)}mul(t){const e=new h(t);return new h(this.x*e.x,this.y*e.y)}div(t){const e=new h(t);return new h(this.x/e.x,this.y/e.y)}add(t){const e=new h(t);return new h(this.x+e.x,this.y+e.y)}sub(t){const e=new h(t);return new h(this.x-e.x,this.y-e.y)}dot(t){const e=new h(t);return this.x*e.x+this.y*e.y}mod(t){const e=new h(t);return new h(this.x%e.x,this.y%e.y)}addX(t){return new h(this.x+t,this.y)}addY(t){return new h(this.x,this.y+t)}toSymbol(){return h.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e){return void 0===e&&(e=n.I),Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}}h.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),h.zero=new h,h.one=new h(1,1),h.right=new h(1,0),h.left=new h(-1,0),h.up=new h(0,1),h.down=new h(0,-1)},49111:(t,e,i)=>{i.d(e,{t:()=>s});class s extends Error{constructor(t,e){super(t),this.remarks=e}}},15649:(t,e,i)=>{i.d(e,{L:()=>s});class s{constructor(){this.resolveCurrent=null,this.current=null}async acquire(){for(;this.current;)await this.current;this.current=new Promise((t=>{this.resolveCurrent=t}))}release(){var t;this.current=null,null==(t=this.resolveCurrent)||t.call(this),this.resolveCurrent=null}}},90031:(t,e,i)=>{function s(t){return{message:t.message,stack:t.stack,remarks:t.remarks}}i.d(e,{d:()=>s})},1119:(t,e,i)=>{function s(t,e){void 0===e&&(e=document.createElement("canvas"));const i=e.getContext("2d",t);if(!i)throw new Error("Could not create a 2D context.");return i}i.d(e,{f:()=>s})},48733:(t,e,i)=>{i.d(e,{I:()=>s,q:()=>r});const s=180/Math.PI,r=Math.PI/180},30092:(t,e,i)=>{i.d(e,{Y:()=>n});var s=i(3163),r=i(56632);function n(t){const e=(0,s.$r)(),i=(0,r.nn)();return e.timeEvents.register(t,i.time())}},97715:(t,e,i)=>{i.d(e,{Mh:()=>a,te:()=>r,wA:()=>n});const s=[];function r(){const t=s.at(-1);if(!t)throw new Error("The playback is not available in the current context.");return t}function n(t){s.push(t)}function a(t){if(s.pop()!==t)throw new Error("startPlayback/endPlayback were called out of order.")}},3163:(t,e,i)=>{i.d(e,{$r:()=>r,DO:()=>n,ug:()=>a,vl:()=>h,wL:()=>o});const s=[];function r(){const t=s.at(-1);if(!t)throw new Error("The scene is not available in the current context.");return t}function n(t){s.push(t)}function a(t){if(s.pop()!==t)throw new Error("startScene/endScene were called out of order.")}function o(){var t;return(null==(t=s.at(-1))?void 0:t.logger)??console}function h(){r().enterCanTransitionOut()}},56632:(t,e,i)=>{i.d(e,{h$:()=>a,kw:()=>o,nn:()=>n});var s=i(49111);const r=[];function n(){const t=r.at(-1);if(!t)throw new s.t("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return t}function a(t){r.push(t)}function o(t){if(r.pop()!==t)throw new Error("startThread/endThread was called out of order.")}},85483:(t,e,i)=>{i.r(e);var s=i(9989),r=i(2672),n=Object.defineProperty,a=(t,e,i)=>(((t,e,i)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);const o=[];class h extends Error{constructor(t,e){super(t),this.remarks=e}}const c=[];function u(){const t=c.at(-1);if(!t)throw new h("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return t}function l(t){return{message:t.message,stack:t.stack,remarks:t.remarks}}const d=180/Math.PI,p=Math.PI/180,f=[];function v(t){const e={[t.name]:t},i=Object.getOwnPropertyDescriptor(e,t.name);for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];if(i)for(let a=r.length-1;a>=0;a--)r[a](e,t.name,i)}function y(t){return function(e,i,s){s.value.prototype.name=t??i,s.value.prototype.threadable=!0}}function g(t,e){const i=Object.getPrototypeOf(t);i.threadable||(i.threadable=!0,i.name="string"==typeof e?e:function(t){return Object.getPrototypeOf(t).name??null}(e))}class m{constructor(){this.subscribable=new b(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map((e=>e(t)))}}class b{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}class w extends m{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}function k(t){const e=function(){const t=o.at(-1);if(!t)throw new Error("The scene is not available in the current context.");return t}(),i=u();return e.timeEvents.register(t,i.time())}function S(t,e,i){return t+(e-t)*i}function x(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),S(e,i,t=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2)}function*M(t,e,i){const s=u(),r=s.time(),n=s.time()+t;for(e(0,0);n>s.fixed;){const i=s.fixed-r;i>0&&e(i/t,i),yield}s.time(n),e(1,t),null==i||i(1,t)}function*I(t,e){void 0===t&&(t=0);const i=u(),s=function(){const t=f.at(-1);if(!t)throw new Error("The playback is not available in the current context.");return t}().framesToSeconds(1),r=i.time()+t;for(;r-s>i.fixed;)yield;i.time(r),e&&(yield*e)}function T(t,e){let i;return"string"==typeof t?(i=e(),g(i,t)):(i=t(),g(i,i)),i}v(M,y()),v((function*(t,e){yield*I(k(t)),e&&(yield*e)}),y()),v(I,y());class P{static collectPromise(t,e){void 0===e&&(e=null);const i={promise:t,value:e,stack:(new Error).stack},s=this.collectionStack.at(-1);return s&&(i.owner=s.owner),t.then((t=>{i.value=t,null==s||s.markDirty()})),this.promises.push(i),i}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map((t=>t.promise))),this.promises=this.promises.filter((e=>!t.includes(e))),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new w,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(P.collectionSet.has(this))throw new h("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");P.collectionSet.add(this),P.collectionStack.push(this)}finishCollecting(){if(P.collectionSet.delete(this),P.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((t=>t.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const t=P.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await P.consumePromises(),this.invokable()}while(P.hasPromises());return this.invokable}}function C(t){return"function"==typeof t}function R(t,e){return C(t)?()=>e(t()):e(t)}P.collectionSet=new Set,P.collectionStack=[],P.promises=[];const E=Symbol.for("@motion-canvas/core/signals/default");class q extends P{constructor(t,e,i,s,r){void 0===i&&(i=void 0),void 0===s&&(s=t=>t),void 0===r&&(r={}),super(i),this.initial=t,this.interpolation=e,this.parser=s,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),C(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===E&&(t=this.initial),this.current===t||(this.current=t,this.markDirty(),this.clearDependencies(),C(t)||(this.last=this.parse(t))),this.owner}get(){return this.extensions.getter()}getter(){var t,e;if(this.event.isRaised()&&C(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(i){((null==(e=o.at(-1))?void 0:e.logger)??console).error({...l(i),inspect:null==(t=this.owner)?void 0:t.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(t,e,i,s){return void 0===i&&(i=x),void 0===s&&(s=this.interpolation),void 0===t?this.get():void 0===e?this.set(t):this.createQueue(i,s).to(t,e)}createQueue(t,e){var i=this;const s=this.get(),r=[],n=T((function*(){for(;r.length>0;)yield*r.shift()}));return n.to=function(s,a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(i.tween(s,a,o,h)),n},n.back=function(a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(i.tween(s,a,t,e)),n},n.wait=t=>(r.push(I(t)),n),n.run=t=>(r.push(t),n),n.do=t=>(r.push(T((function*(){t()}))),n),n}*tween(t,e,i,s){t===E&&(t=this.initial),yield*this.extensions.tweener(t,e,i,s),this.set(t)}*tweener(t,e,i,s){const r=this.get();yield*M(e,(e=>{var n;this.set(s(r,this.parse(C(n=t)?n():n),i(e)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class A extends q{constructor(t,e,i,s,r,n){var a;void 0===r&&(r=void 0),void 0===n&&(n={}),super(void 0,s,r,e,n),this.entries=t,this.signals=[],this.parser=e;for(const o of t){let t,s;Array.isArray(o)?([t,s]=o,(a=s.context).owner??(a.owner=this)):(t=o,s=new q(R(i,(t=>e(t)[o])),S,r??this.invokable).toSignal()),this.signals.push([t,s]),Object.defineProperty(this.invokable,t,{value:s})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map((t=>{let[e,i]=t;return[e,i()]}))))}setter(t){if(C(t))for(const[e,i]of this.signals)i((()=>this.parser(t())[e]));else{const e=this.parse(t);for(const[t,i]of this.signals)i(e[t])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}}var L,D,j,O;(D=L||(L={}))[D.Vertical=1]="Vertical",D[D.Horizontal=2]="Horizontal",function(t){t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.Left=16]="Left",t[t.Right=32]="Right"}(j||(j={})),function(t){t[t.Middle=3]="Middle",t[t.Top=5]="Top",t[t.Bottom=9]="Bottom",t[t.Left=18]="Left",t[t.Right=34]="Right",t[t.TopLeft=20]="TopLeft",t[t.TopRight=36]="TopRight",t[t.BottomLeft=24]="BottomLeft",t[t.BottomRight=40]="BottomRight"}(O||(O={}));class z{static createSignal(t,e,i){return void 0===e&&(e=z.lerp),new A(["x","y"],(t=>new z(t)),t,e,i).toSignal()}static lerp(t,e,i){let s,r;return"number"==typeof i?s=r=i:(s=i.x,r=i.y),new z(S(t.x,e.x,s),S(t.y,e.y,r))}static arcLerp(t,e,i,s,r){return void 0===s&&(s=!1),r??(r=t.sub(e).ctg),z.lerp(t,e,function(t,e,i){let s=e;i>1?i=1/i:s=!s;const r=s?Math.acos(function(t,e,i){return i<t?t:i>e?e:i}(-1,1,1-t)):Math.asin(t),n=S(r,S(0,Math.PI/2,t),i);let a=Math.sin(n),o=1-Math.cos(n);return e&&([a,o]=[o,a]),new z(a,o)}(i,s,r))}static createArcLerp(t,e){return(i,s,r)=>z.arcLerp(i,s,r,t,e)}static fromOrigin(t){const e=new z;return t===O.Middle||(t&j.Left?e.x=-1:t&j.Right&&(e.x=1),t&j.Top?e.y=-1:t&j.Bottom&&(e.y=1)),e}static fromScalar(t){return new z(t,t)}static fromRadians(t){return new z(Math.cos(t),Math.sin(t))}static fromDegrees(t){return z.fromRadians(t*p)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return z.radians(t,e)*d}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return z.magnitude(this.x,this.y)}get squaredMagnitude(){return z.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/z.magnitude(this.x,this.y))}get safe(){return new z(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new z(-this.x,-this.y)}get floored(){return new z(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new z(this.y,-this.x)}get radians(){return z.radians(this.x,this.y)}get degrees(){return z.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,null!=t){if("object"!=typeof t)return this.x=t,void(this.y=e??t);if(Array.isArray(t))return this.x=t[0],void(this.y=t[1]);if("width"in t)return this.x=t.width,void(this.y=t.height);this.x=t.x,this.y=t.y}}lerp(t,e){return z.lerp(this,t,e)}getOriginOffset(t){const e=z.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new z(this.x*t,this.y*t)}transformAsPoint(t){return new z(this.x*t.m11+this.y*t.m21+t.m41,this.x*t.m12+this.y*t.m22+t.m42)}transform(t){return new z(this.x*t.m11+this.y*t.m21,this.x*t.m12+this.y*t.m22)}mul(t){const e=new z(t);return new z(this.x*e.x,this.y*e.y)}div(t){const e=new z(t);return new z(this.x/e.x,this.y/e.y)}add(t){const e=new z(t);return new z(this.x+e.x,this.y+e.y)}sub(t){const e=new z(t);return new z(this.x-e.x,this.y-e.y)}dot(t){const e=new z(t);return this.x*e.x+this.y*e.y}mod(t){const e=new z(t);return new z(this.x%e.x,this.y%e.y)}addX(t){return new z(this.x+t,this.y)}addY(t){return new z(this.x,this.y+t)}toSymbol(){return z.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e){return void 0===e&&(e=1e-6),Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}}z.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),z.zero=new z,z.one=new z(1,1),z.right=new z(1,0),z.left=new z(-1,0),z.up=new z(0,1),z.down=new z(0,-1);const N="motion-canvas-player";class B extends HTMLElement{constructor(){super(),a(this,"root"),a(this,"canvas"),a(this,"overlay"),a(this,"button"),a(this,"state","initial"),a(this,"project",null),a(this,"player",null),a(this,"defaultSettings"),a(this,"abortController",null),a(this,"mouseMoveId",null),a(this,"finished",!1),a(this,"playing",!1),a(this,"connected",!1),a(this,"stage",new s.H),a(this,"handleMouseMove",(()=>{this.mouseMoveId&&clearTimeout(this.mouseMoveId),this.hover&&!this.playing&&this.setPlaying(!0),this.mouseMoveId=window.setTimeout((()=>{this.mouseMoveId=null,this.updateClass()}),2e3),this.updateClass()})),a(this,"handleMouseLeave",(()=>{this.hover&&this.setPlaying(!1),this.mouseMoveId&&(clearTimeout(this.mouseMoveId),this.mouseMoveId=null,this.updateClass())})),a(this,"handleMouseDown",(t=>{t.preventDefault()})),a(this,"handleClick",(()=>{this.auto||(this.handleMouseMove(),this.setPlaying(!this.playing),this.button.animate([{scale:"0.9"},{scale:"1",easing:"ease-out"}],{duration:200}))})),a(this,"render",(async()=>{this.player&&await this.stage.render(this.player.playback.currentScene,this.player.playback.previousScene)})),this.root=this.attachShadow({mode:"open"}),this.root.innerHTML='<style>.initial{display:none}.state-initial .initial{display:block}.loading{display:none}.state-loading .loading{display:block}.ready{display:none}.state-ready .ready{display:block}.error{display:none}.state-error .error{display:block}:host{position:relative;display:block}.overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;opacity:0;background-color:#0000008a;transition:opacity .1s}.overlay.state-ready:not(.auto){cursor:pointer}.overlay.playing:not(.hover):hover{cursor:none}.overlay.hover,.overlay.state-ready:focus-within,.overlay.state-ready:not(.playing){opacity:1}.overlay.hover .button,.overlay.state-ready:focus-within .button,.overlay.state-ready:not(.playing) .button{scale:1;transition:scale .1s ease-out}.overlay.state-loading,.overlay.state-error{opacity:1;transition:opacity 1s}.overlay.state-ready.auto{opacity:0}.button{width:50%;max-width:96px;aspect-ratio:1;scale:.5;transition:scale .1s ease-in,opacity .1s;background-color:transparent;border:none;background-size:100% 100%;background-repeat:no-repeat;opacity:.54;cursor:inherit;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bS0yIDE0LjV2LTlsNiA0LjUtNiA0LjV6Ii8+PC9zdmc+)}.playing .button{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiNmZmZmZmYiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PHBhdGggZD0iTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMSwxNkg5VjhoMlYxNnogTTE1LDE2aC0yVjhoMlYxNnoiLz48L2c+PC9zdmc+)}.button:focus,.overlay:hover .button{opacity:.87}.auto .button{display:none}.canvas{width:100%;display:block;opacity:0;transition:opacity .1s}.canvas.state-ready{opacity:1}.message{font-family:JetBrains Mono,sans-serif;text-align:center;font-size:20px;padding:8px 16px;margin:16px;border-radius:4px;color:#fff9;background-color:#000000de}.loader{width:50%;max-width:96px;display:none;rotate:-90deg;animation:stroke 2s cubic-bezier(.5,0,.5,1) infinite,rotate 2s linear infinite}@keyframes stroke{0%{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:2.8274333882px}50%{stroke-dasharray:50.8938009883px 5.6548667765px;stroke-dashoffset:-2.8274333882px}to{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:-53.7212343766px}}@keyframes rotate{0%{rotate:-110deg}to{rotate:250deg}}\n</style><div class="overlay">\n  <button title="Play / Pause" class="button ready" tabindex="0"></button>\n  <div class="message error">\n    An error occurred while loading the animation.\n  </div>\n  <svg\n    class="loader loading"\n    viewBox="0 0 24 24"\n    stroke="#ffffff"\n    stroke-width="2"\n    fill="transparent"\n  >\n    <circle cx="12" cy="12" r="9" />\n  </svg>\n</div>\n',this.overlay=this.root.querySelector(".overlay"),this.button=this.root.querySelector(".button"),this.canvas=this.stage.finalBuffer,this.canvas.classList.add("canvas"),this.root.prepend(this.canvas),this.overlay.addEventListener("click",this.handleClick),this.overlay.addEventListener("mousemove",this.handleMouseMove),this.overlay.addEventListener("mouseleave",this.handleMouseLeave),this.button.addEventListener("mousedown",this.handleMouseDown),this.setState("initial")}static get observedAttributes(){return["src","quality","width","height","auto","variables"]}get auto(){return!!this.getAttribute("auto")}get hover(){return"hover"===this.getAttribute("auto")}get quality(){const t=this.getAttribute("quality");return t?parseFloat(t):this.defaultSettings.resolutionScale}get width(){const t=this.getAttribute("width");return t?parseFloat(t):this.defaultSettings.size.width}get height(){const t=this.getAttribute("height");return t?parseFloat(t):this.defaultSettings.size.height}get variables(){try{const t=this.getAttribute("variables");return t?JSON.parse(t):{}}catch{return this.project.logger.warn("Project variables could not be parsed."),{}}}setState(t){this.state=t,this.setPlaying(this.playing)}setPlaying(t){var e,i;"ready"===this.state&&(t||this.auto&&!this.hover)?(null==(e=this.player)||e.togglePlayback(!0),this.playing=!0):(null==(i=this.player)||i.togglePlayback(!1),this.playing=!1),this.updateClass()}updateClass(){this.overlay.className=`overlay state-${this.state}`,this.canvas.className=`canvas state-${this.state}`,this.overlay.classList.toggle("playing",this.playing),this.overlay.classList.toggle("auto",this.auto),this.overlay.classList.toggle("hover",null!==this.mouseMoveId),this.connected&&(null===this.mouseMoveId&&this.playing?delete this.dataset.overlay:this.dataset.overlay="")}async updateSource(t){var e,i,s,n;let a;this.setState("initial"),null==(e=this.abortController)||e.abort(),this.abortController=new AbortController;try{const e=import(t),i=new Promise((t=>setTimeout(t,200)));await Promise.any([i,e]),this.setState("loading"),a=(await e).default}catch(h){return console.error(h),void this.setState("error")}this.defaultSettings=a.meta.getFullRenderingSettings();const o=new r.J(a);o.setVariables(this.variables),this.finished=!1,null==(i=this.player)||i.onRender.unsubscribe(this.render),null==(s=this.player)||s.togglePlayback(!1),null==(n=this.player)||n.deactivate(),this.project=a,this.player=o,this.updateSettings(),this.player.onRender.subscribe(this.render),this.player.togglePlayback(this.playing),this.setState("ready")}attributeChangedCallback(t,e,i){var s;switch(t){case"auto":this.setPlaying(this.playing);break;case"src":this.updateSource(i);break;case"quality":case"width":case"height":this.updateSettings();break;case"variables":null==(s=this.player)||s.setVariables(this.variables)}}disconnectedCallback(){var t,e;this.connected=!1,null==(t=this.player)||t.deactivate(),null==(e=this.player)||e.onRender.unsubscribe(this.render)}connectedCallback(){var t,e;this.connected=!0,null==(t=this.player)||t.activate(),null==(e=this.player)||e.onRender.subscribe(this.render)}updateSettings(){const t={...this.defaultSettings,size:new z(this.width,this.height),resolutionScale:this.quality};this.stage.configure(t),this.player.configure(t)}}customElements.get(N)||customElements.define(N,B)}}]);